# Lab: User role can be modified in user profile

## 1. Vulnerability Description
**Type:** Mass Assignment / Auto-Binding
**Severity:** High

The application suffers from a Mass Assignment vulnerability in the user profile update feature. The backend framework accepts a JSON object to update user details (such as email) and binds these input parameters directly to the database model without sufficient filtering. This allows a low-privileged user to inject restricted internal parameters, specifically `roleid`, into the JSON request body. By manually setting `"roleid": 2`, a user can escalate their privileges to Administrator.

## 2. Steps to Reproduce
1.  Log in to the application as a standard user (`wiener`).
2.  Navigate to the **My Account** page.
3.  Enter a new email address and click **Update Email**, intercepting the request with Burp Suite.
4.  Observe that the request body contains a JSON object:
    ```json
    {
      "email": "wiener@normal-user.net"
    }
    ```
5.  Modify the JSON payload to include the administrative role identifier:
    ```json
    {
      "email": "wiener@normal-user.net",
      "roleid": 2
    }
    ```
6.  Send the modified request. The server returns `200 OK`, confirming the update was processed.
7.  Refresh the browser or navigate to `/admin` to confirm administrative access.
8.  Delete the user `carlos` to demonstrate the impact of the privilege escalation.

## 3. Impact
* **Horizontal & Vertical Privilege Escalation:** Attackers can modify any field on the user model, including roles, account balances, or subscription tiers.
* **Full System Compromise:** Gaining administrative access allows for the deletion of users and potential access to further system settings.

## 4. Remediation
**Use Data Transfer Objects (DTOs):**
Do not bind HTTP request data directly to persistent database entities. Instead, use a DTO that only contains the fields intended for user modification (e.g., `UpdateEmailRequest` class containing only the `email` string).

**Field Whitelisting:**
If direct binding is necessary, explicitly configure the framework to only accept specific fields and ignore or reject all others.
